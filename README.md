# SSH Security Configuration Script (KIT-SSCS)

![License](https://img.shields.io/badge/license-MIT-blue.svg) ![Version](https://img.shields.io/badge/version-1.0-green.svg)

---

## Описание

Этот скрипт автоматизирует настройку безопасности SSH-сервера, обеспечивая защиту от распространенных угроз и повышая общую безопасность системы. Он выполняет следующие задачи:

- **Создание безопасного конфигурационного файла `sshd_config`:**
  - Настройка современного криптографического алгоритма (Ed25519).
  - Отключение небезопасных протоколов и методов аутентификации.
  - Ограничение доступа только для указанного пользователя.

- **Генерация новых SSH-ключей:**
  - Создание нового ключа `ssh_host_ed25519_key` для сервера.
  - Удаление старых ключей для предотвращения использования устаревших или скомпрометированных ключей.

- **Настройка прав доступа:**
  - Установка корректных прав на ключи, конфигурационные файлы и баннеры.
  - Защита от несанкционированного доступа к чувствительным файлам.

- **Настройка баннера:**
  - Создание и настройка баннера с предупреждением для пользователей при подключении.

- **Настройка ротации логов:**
  - Автоматическая ротация логов для мониторинга активности.
  - Сжатие старых логов и ограничение их количества.

- **Перезапуск сервиса и тестирование конфигурации:**
  - Проверка корректности открытых портов и их соответствия настройкам.
  - Тестирование всех параметров безопасности SSH.
  - Проверка работоспособности ротации логов.

---

## Аргументы

Скрипт поддерживает следующие аргументы для настройки:

- `-u, --user`: Пользователь для доступа по SSH.
- `-p, --port`: Порт для прослушивания SSH (по умолчанию `22`).
- `-a, --address`: IP-адрес для прослушивания (по умолчанию `0.0.0.0`).

Пример запуска:
```bash
./ssh_security_setup.sh --user user1 --port 12345 --address 10.1.1.1
```

---

## Пример вывода

```bash
[2023-10-15 12:00:00] Проверка зависимостей...
[2023-10-15 12:00:01] Все зависимости найдены.
[2023-10-15 12:00:02] Проверка пользователя 'user1'...
[2023-10-15 12:00:03] Пользователь 'user1' существует.
[2023-10-15 12:00:04] Проверка IP-адреса 10.1.1.1...
[2023-10-15 12:00:05] IP-адрес 10.1.1.1 найден среди доступных адресов.
[2023-10-15 12:00:06] Создание файла конфигурации /etc/ssh/sshd_config...
[2023-10-15 12:00:07] Файл конфигурации /etc/ssh/sshd_config успешно создан.
[2023-10-15 12:00:08] Удаление всех старых ключей...
[2023-10-15 12:00:09] Все старые ключи удалены.
[2023-10-15 12:00:10] Создание нового ключа ssh_host_ed25519_key...
[2023-10-15 12:00:11] Создан новый ключ ssh_host_ed25519_key.
[2023-10-15 12:00:12] Установка прав на ключи и конфигурацию...
[2023-10-15 12:00:13] Права на файлы установлены.
[2023-10-15 12:00:14] Настройка баннера...
[2023-10-15 12:00:15] Баннер создан и настроен.
[2023-10-15 12:00:16] Настройка ротации логов...
[2023-10-15 12:00:17] Настроена ротация логов для SSH.
[2023-10-15 12:00:18] Проверка конфигурации SSH...
[2023-10-15 12:00:19] Конфигурация SSH-сервера корректна.
[2023-10-15 12:00:20] Перезапуск SSH-сервера...
[2023-10-15 12:00:21] SSH-сервер успешно запущен.
[2023-10-15 12:00:22] Выполнение тестов...
✓ Тест портов: Сервис sshd слушает только один порт (12345) на адресе 10.1.1.1.
✓ Права на файл /etc/ssh/sshd_config корректны.
✓ Права на приватный ключ /etc/ssh/ssh_host_ed25519_key корректны.
✓ Права на публичный ключ /etc/ssh/ssh_host_ed25519_key.pub корректны.
✓ Все параметры конфигурации SSH корректны.
✓ Все тесты ротации логов пройдены успешно.
[2023-10-15 12:00:23] Настройка безопасности SSH завершена.
```

---

## Зависимости

Для работы скрипта требуются следующие инструменты:
- Bash (тестировано на версии 5.2+)
- OpenSSH Server (тестировано на версии 9.2+)
- Coreutils (например, `grep`, `awk`, `sed`)
- Logrotate (для настройки ротации логов)
- Systemd (для управления службой SSH)

---

## Инструкция по использованию

1. **Сделайте скрипт исполняемым:**
   ```bash
   chmod +x ssh_security_setup.sh
   ```

2. **Запустите скрипт:**
   ```bash
   ./ssh_security_setup.sh --user user1 --port 12345 --address 10.1.1.1
   ```

3. **Следуйте инструкциям на экране.**

---

## Автор

**Kudesnik-IT**  
Email: [kudesnik.it@gmail.com](mailto:kudesnik.it@gmail.com)  
GitHub: [@Kudesnik-IT](https://github.com/Kudesnik-IT)

---

## Поддержка

Если вы нашли ошибку или хотите предложить улучшение, создайте issue в репозитории или свяжитесь с автором.

---

## Благодарности

Спасибо за использование KIT-SSCS! Надеюсь, что этот скрипт поможет быстро и эффективно настраивать сервис SSH.
